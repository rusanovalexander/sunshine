# patch_gguf_arch.py
import sys
from gguf import GGUFReader, GGUFWriter, GGUFValueType

src = "/home/inghero/data/irwbds/llm/parc/Ministral-14B-GGUF/Ministral-3-14B-Instruct-2512-Q5_K_M.gguf"
dst = "/home/inghero/data/irwbds/llm/parc/Ministral-14B-GGUF/Ministral-3-14B-patched.gguf"

reader = GGUFReader(src)
writer = GGUFWriter(dst, arch="mistral")

for field in reader.fields.values():
    if field.name == "general.architecture":
        writer.add_string("general.architecture", "mistral")
    else:
        writer.add_key_value(field.name, field.contents(), field.types[0])

for tensor in reader.tensors:
    writer.add_tensor(tensor.name, tensor.data, tensor.tensor_type)

writer.write_header_to_file()
writer.write_kv_data_to_file()
writer.write_tensors_to_file()
writer.close()
print("Done â†’", dst)
